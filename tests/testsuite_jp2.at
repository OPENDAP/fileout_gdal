# Process with autom4te to create an -*- Autotest -*- test suite.

# ------------------------------
#

AT_INIT([bes.conf besstandalone getdap])
# AT_COPYRIGHT([])

AT_TESTED([besstandalone])

# This is broken - all baselines are dumped to *.tif files. 12/17/12 jhrg
AT_ARG_OPTION_ARG([generate g],
    [  -g arg, --generate=arg   Build the baseline file for test 'arg'],
    [if ./generate_data_baseline.sh $at_arg_generate; then
         echo "Built baseline for $at_arg_generate"
     else
         echo "Could not generate baseline for $at_arg_generate_data"
     fi     
     exit],[])

# Usage: _AT_TEST_*(<bescmd source>, <baseline file extension>, [pass|xfail])

# These error tests don't have baselines, I only test that an error is returned.

m4_define([AT_BESCMD_ERROR_RESPONSE_TEST],
[AT_SETUP([BESCMD $1])
AT_KEYWORDS([errors])
AT_CHECK([besstandalone -c $abs_builddir/bes.conf -i $abs_srcdir/$1 || true], [], [stdout], [stderr])
AT_CHECK([grep BESError stdout || grep BESError stderr], [], [ignore],[],[])
AT_XFAIL_IF([test "$2" = "xfail"])
AT_CLEANUP]
])

m4_define([AT_BESCMD_BINARYDATA_RESPONSE_TEST],
[AT_SETUP([BESCMD $1])
AT_KEYWORDS([data])
AT_CHECK([besstandalone -c $abs_builddir/bes.conf -i $abs_srcdir/$1 || true], [], [stdout], [stderr])
AT_CHECK([cmp $abs_srcdir/$1.$2 stdout || cmp $abs_srcdir/$1.$2 stderr], [], [ignore],[],[])
AT_XFAIL_IF([test "$3" = "xfail"])
AT_CLEANUP]
])

AT_BESCMD_BINARYDATA_RESPONSE_TEST([gdal/coads_climatology.nc.2.bescmd], [jp2], [pass])
